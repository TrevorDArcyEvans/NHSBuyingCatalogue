<div id="compliance" class="evidence page">

{{> errors}}

{{#if hasFeedback}}
<p class="has-feedback">
  {{{t 'CompliancePages.Evidence.History.HasFeedback' id=feedbackId}}}
</p>
{{/if}}

<header class="page-main-heading">
  <h1>{{ claim.standard.name }}</h1>
  <p>{{t 'CompliancePages.Evidence.Subtitle'}}</p>
</header>

{{#each (tt 'CompliancePages.Evidence.Preamble')}}
<p class="preamble">{{{.}}}</p>
{{/each}}

<details class="quick-links">
  <summary>{{t 'CompliancePages.Evidence.QuickLinks.Heading'}}</summary>
  <ul>
    <li><a href="{{claim.standard.url}}" target="_blank">{{claim.standard.name}}</a></li>
    {{#claim.capabilities}}
    <li><a href="{{url}}" target="_blank">{{name}}</a></li>
    {{/claim.capabilities}}
  </ul>
</details>

{{#if claim.submissionHistory}}
  <section class="history collapsed">
    <h3>{{t 'CompliancePages.Evidence.History.Heading'}}</h3>

    {{#if collapseHistory}}
    <a href="#" class="expand-history">{{t 'CompliancePages.Evidence.History.Show'}}</a>
    <a href="#" class="collapse-history">{{t 'CompliancePages.Evidence.History.Hide'}}</a>
    {{/if}}

    {{#claim.submissionHistory}}
    <div id="{{id}}" class="message{{#isFeedback}} feedback{{/isFeedback}}">
      <p class="text">{{message}}</p>
      <p class="meta">
        <span class="when">{{createdOn}}</span>
        <span class="from">
        {{#with (lookup ../claim.historyContacts createdById)}}
          {{firstName}} {{lastName}}
        {{/with}}
        </span>
        <span class="what">
          {{#if isFeedback}}
            {{t 'CompliancePages.Evidence.History.FeedbackSent'}}
          {{else}}
            {{t 'CompliancePages.Evidence.History.FileSent'}}
          {{/if}}
        </span>
      </p>
    </div>
    {{/claim.submissionHistory}}
  </section>
{{/if}}

{{#if latestFile}}
  {{#if allowSubmission}}
  <section class="current-file">
    <h3>{{t 'CompliancePages.Evidence.CurrentFile.Heading'}}</h3>
    <p class="callout">
      <a href="{{latestFile.downloadURL}}">{{latestFile.name}}</a>
    </p>
  </section>

  <section class="upload-and-reply">
    <h3>{{t 'CompliancePages.Evidence.Reply.Heading'}}</h3>
    {{#>form encoding="multipart/form-data"}}
      <fieldset class="callout">
        <input type="file" name="matrix-file">
        <button type="submit">{{t 'CompliancePages.Evidence.Buttons.Upload'}}</button>
      </fieldset>

      <button id="submit-for-compliance" type="submit" class="primary">{{t 'CompliancePages.Evidence.Buttons.Submit'}}</button>
    {{/form}}
  </section>
  {{else}}
    <button id="submit-for-compliance" type="submit" class="primary" disabled>{{t 'CompliancePages.Evidence.Buttons.Submit'}}</button>
  {{/if}}
{{else}}
  <div>
    {{#each (tt 'CompliancePages.Evidence.CurrentFile.Missing')}}
    <p>{{{.}}}</p>
    {{/each}}
  </div>
{{/if}}

<a class="back-link" href="../../">{{t 'CompliancePages.Evidence.Backlink.Title'}}</a>

</div>

<script type="text/javascript">
/* global $$ */
document.addEventListener('DOMContentLoaded', function () {
  $$('#compliance .history .expand-history, #compliance .history .collapse-history').forEach(
    function (el) {
      el.addEventListener('click', function (ev) {
        ev.preventDefault()
        el.closest('.history').classList.toggle('collapsed')
      })
    }
  )
})
</script>
